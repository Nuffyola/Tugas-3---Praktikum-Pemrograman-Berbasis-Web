<!-- Template: Stock Table Component (Halaman Stok Bahan Ajar) -->
<!-- ID: tpl-stock-table -->
<template id="tpl-stock-table">
    <div class="stock-page">
        <!-- Summary Cards -->
        <div class="stock-summary">
            <div class="summary-card safe">
                <div class="number">{{ safeCount }}</div>
                <div class="label">Stok Aman</div>
            </div>
            <div class="summary-card warning">
                <div class="number">{{ lowCount }}</div>
                <div class="label">Stok Menipis</div>
            </div>
            <div class="summary-card danger">
                <div class="number">{{ emptyCount }}</div>
                <div class="label">Stok Kosong</div>
            </div>
            <div class="summary-card">
                <div class="number">{{ totalItems }}</div>
                <div class="label">Total Item</div>
            </div>
        </div>

        <!-- Filter Section -->
        <div class="filter-section">
            <div class="filter-row">
                <!-- Filter UPBJJ -->
                <div class="filter-group">
                    <label for="filter-upbjj">Filter UT-Region (UPBJJ)</label>
                    <select id="filter-upbjj" v-model="filters.upbjj" class="form-control">
                        <option value="">Semua Region</option>
                        <option v-for="upbjj in upbjjList" :key="upbjj" :value="upbjj">
                            {{ upbjj }}
                        </option>
                    </select>
                </div>

                <!-- Filter Kategori (Dependent on UPBJJ) -->
                <div class="filter-group" v-show="filters.upbjj">
                    <label for="filter-kategori">Filter Kategori</label>
                    <select id="filter-kategori" v-model="filters.kategori" class="form-control">
                        <option value="">Semua Kategori</option>
                        <option v-for="kat in availableKategori" :key="kat" :value="kat">
                            {{ kat }}
                        </option>
                    </select>
                </div>

                <!-- Sort By -->
                <div class="filter-group">
                    <label for="sort-by">Urutkan Berdasarkan</label>
                    <select id="sort-by" v-model="sortBy" class="form-control">
                        <option value="">Pilih Urutan</option>
                        <option value="judul-asc">Judul (A-Z)</option>
                        <option value="judul-desc">Judul (Z-A)</option>
                        <option value="qty-asc">Stok (Terendah)</option>
                        <option value="qty-desc">Stok (Tertinggi)</option>
                        <option value="harga-asc">Harga (Terendah)</option>
                        <option value="harga-desc">Harga (Tertinggi)</option>
                    </select>
                </div>

                <!-- Filter Status Stok -->
                <div class="filter-group">
                    <label>Filter Status Stok</label>
                    <div class="filter-checkbox">
                        <input type="checkbox" id="filter-low" v-model="filters.showLowStock">
                        <label for="filter-low">Tampilkan stok menipis/kosong saja</label>
                    </div>
                </div>
            </div>

            <div class="filter-actions mt-2">
                <button class="btn btn-secondary btn-sm" @click="resetFilters">
                    üîÑ Reset Filter
                </button>
                <button class="btn btn-success btn-sm" @click="showAddModal = true">
                    ‚ûï Tambah Bahan Ajar
                </button>
            </div>
        </div>

        <!-- Data Table -->
        <div class="card">
            <div class="card-header d-flex justify-between align-center">
                <h2>üìö Daftar Stok Bahan Ajar</h2>
                <span class="text-muted">Menampilkan {{ filteredAndSortedData.length }} dari {{ stokList.length }} data</span>
            </div>
            <div class="card-body">
                <div class="table-container">
                    <table class="data-table" v-if="filteredAndSortedData.length > 0">
                        <thead>
                            <tr>
                                <th>No</th>
                                <th class="sortable" @click="toggleSort('judul')">
                                    Kode / Judul
                                    <span class="sort-icon">{{ getSortIcon('judul') }}</span>
                                </th>
                                <th>Kategori</th>
                                <th>UT-Region</th>
                                <th>Lokasi Rak</th>
                                <th class="sortable" @click="toggleSort('harga')">
                                    Harga
                                    <span class="sort-icon">{{ getSortIcon('harga') }}</span>
                                </th>
                                <th class="sortable" @click="toggleSort('qty')">
                                    Stok
                                    <span class="sort-icon">{{ getSortIcon('qty') }}</span>
                                </th>
                                <th>Safety Stock</th>
                                <th>Status</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="(item, index) in filteredAndSortedData" :key="item.kode">
                                <td>{{ index + 1 }}</td>
                                <td>
                                    <strong>{{ item.kode }}</strong><br>
                                    <small>{{ item.judul }}</small>
                                </td>
                                <td>{{ item.kategori }}</td>
                                <td>{{ item.upbjj }}</td>
                                <td>{{ item.lokasiRak }}</td>
                                <td>{{ formatRupiah(item.harga) }}</td>
                                <td>{{ formatQty(item.qty) }}</td>
                                <td>{{ formatQty(item.safety) }}</td>
                                <td>
                                    <status-badge 
                                        :qty="item.qty" 
                                        :safety="item.safety" 
                                        :tooltip="item.catatanHTML">
                                    </status-badge>
                                </td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="btn btn-warning btn-icon btn-sm" 
                                                @click="editItem(item)" 
                                                title="Edit">
                                            ‚úèÔ∏è
                                        </button>
                                        <button class="btn btn-danger btn-icon btn-sm" 
                                                @click="confirmDelete(item)" 
                                                title="Hapus">
                                            üóëÔ∏è
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>

                    <!-- Empty State -->
                    <div class="empty-state" v-else>
                        <div class="icon">üì≠</div>
                        <h3>Tidak ada data ditemukan</h3>
                        <p>Coba ubah filter atau tambahkan data baru</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Add/Edit Modal -->
        <app-modal 
            :show="showAddModal || showEditModal" 
            :title="showEditModal ? 'Edit Bahan Ajar' : 'Tambah Bahan Ajar Baru'"
            :confirm-text="showEditModal ? 'Update' : 'Simpan'"
            :confirm-disabled="!isFormValid"
            max-width="600px"
            @close="closeFormModal"
            @confirm="saveItem">
            
            <form @submit.prevent="saveItem" @keydown.enter="saveItem">
                <div class="form-row">
                    <div class="form-group">
                        <label class="required">Kode Bahan Ajar</label>
                        <input type="text" 
                               class="form-control" 
                               :class="{'is-invalid': formErrors.kode}"
                               v-model="formData.kode" 
                               placeholder="Contoh: EKMA4116"
                               :disabled="showEditModal">
                        <div class="invalid-feedback" v-if="formErrors.kode">{{ formErrors.kode }}</div>
                    </div>
                    <div class="form-group">
                        <label class="required">Judul</label>
                        <input type="text" 
                               class="form-control"
                               :class="{'is-invalid': formErrors.judul}"
                               v-model="formData.judul" 
                               placeholder="Judul bahan ajar">
                        <div class="invalid-feedback" v-if="formErrors.judul">{{ formErrors.judul }}</div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="required">Kategori</label>
                        <select class="form-control" 
                                :class="{'is-invalid': formErrors.kategori}"
                                v-model="formData.kategori">
                            <option value="">Pilih Kategori</option>
                            <option v-for="kat in kategoriList" :key="kat" :value="kat">
                                {{ kat }}
                            </option>
                        </select>
                        <div class="invalid-feedback" v-if="formErrors.kategori">{{ formErrors.kategori }}</div>
                    </div>
                    <div class="form-group">
                        <label class="required">UT-Region (UPBJJ)</label>
                        <select class="form-control"
                                :class="{'is-invalid': formErrors.upbjj}"
                                v-model="formData.upbjj">
                            <option value="">Pilih Region</option>
                            <option v-for="upbjj in upbjjList" :key="upbjj" :value="upbjj">
                                {{ upbjj }}
                            </option>
                        </select>
                        <div class="invalid-feedback" v-if="formErrors.upbjj">{{ formErrors.upbjj }}</div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="required">Lokasi Rak</label>
                        <input type="text" 
                               class="form-control"
                               :class="{'is-invalid': formErrors.lokasiRak}"
                               v-model="formData.lokasiRak" 
                               placeholder="Contoh: R1-A3">
                        <div class="invalid-feedback" v-if="formErrors.lokasiRak">{{ formErrors.lokasiRak }}</div>
                    </div>
                    <div class="form-group">
                        <label class="required">Harga (Rp)</label>
                        <input type="number" 
                               class="form-control"
                               :class="{'is-invalid': formErrors.harga}"
                               v-model.number="formData.harga" 
                               placeholder="0"
                               min="0">
                        <div class="invalid-feedback" v-if="formErrors.harga">{{ formErrors.harga }}</div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="required">Jumlah Stok</label>
                        <input type="number" 
                               class="form-control"
                               :class="{'is-invalid': formErrors.qty}"
                               v-model.number="formData.qty" 
                               placeholder="0"
                               min="0">
                        <div class="invalid-feedback" v-if="formErrors.qty">{{ formErrors.qty }}</div>
                    </div>
                    <div class="form-group">
                        <label class="required">Safety Stock</label>
                        <input type="number" 
                               class="form-control"
                               :class="{'is-invalid': formErrors.safety}"
                               v-model.number="formData.safety" 
                               placeholder="0"
                               min="0">
                        <div class="invalid-feedback" v-if="formErrors.safety">{{ formErrors.safety }}</div>
                    </div>
                </div>

                <div class="form-group">
                    <label>Catatan (HTML)</label>
                    <input type="text" 
                           class="form-control"
                           v-model="formData.catatanHTML" 
                           placeholder="Catatan tambahan (bisa menggunakan HTML)">
                </div>
            </form>
        </app-modal>

        <!-- Delete Confirmation Modal -->
        <app-modal 
            :show="showDeleteModal" 
            title="Konfirmasi Hapus"
            confirm-text="Ya, Hapus"
            max-width="400px"
            @close="showDeleteModal = false"
            @confirm="deleteItem">
            <div class="text-center">
                <div style="font-size: 3rem; margin-bottom: 15px;">‚ö†Ô∏è</div>
                <p>Apakah Anda yakin ingin menghapus bahan ajar:</p>
                <p><strong>{{ itemToDelete ? itemToDelete.kode : '' }}</strong></p>
                <p>{{ itemToDelete ? itemToDelete.judul : '' }}</p>
                <p class="text-danger mt-2"><small>Tindakan ini tidak dapat dibatalkan!</small></p>
            </div>
        </app-modal>
    </div>
</template>
